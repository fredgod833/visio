<div class="chat-container">
  <!-- Zone de Chat -->
  <div class="chat-section" [class.minimized]="isVideoCallActive">
    <div class="chat-header">
      <h2>Chat - {{ roomId }}</h2>
      <!-- âœ… Utiliser isConnected() avec des parenthÃ¨ses pour lire le Signal -->
      <span class="status" [class.connected]="isConnected()">
        {{ isConnected() ? 'ConnectÃ© âœ…' : 'DÃ©connectÃ© âŒ' }}
        <small style="font-size: 0.7em;">({{ isConnected() }})</small>
      </span>
    </div>

    <div class="messages-container" #messagesContainer>
        <!-- âœ… Utiliser messages() avec parenthÃ¨ses pour lire le Signal -->
        @for (message of messages(); track message.id) {
            <div    [class.own-message]="message.sender === username"
                    [class.system-message]="message.type !== 'CHAT'"
                    class="message">
                <div class="message-sender" (click)="setOther(message.sender)">{{ message.sender }}</div>
                <div class="message-content">{{ message.content }}</div>
                <div class="message-time">
                    {{ message.timestamp | date:'short' }}
                </div>
            </div>
        }
    </div>

    <div class="input-container">
      <input
        type="text"
        [(ngModel)]="newMessage"
        (keyup.enter)="sendMessage()"
        placeholder="Tapez votre message..."
        [disabled]="!isConnected()">

      <button (click)="sendMessage()" [disabled]="!isConnected()">
        Envoyer
      </button>

      <button
        (click)="startVideoCall()"
        [disabled]="!isConnected() || isVideoCallActive"
        class="video-btn">
        ğŸ“¹ Appel VidÃ©o
      </button>

      <button
        (click)="logout()"
        class="logout-btn">
        ğŸšª DÃ©connexion
      </button>
    </div>
  </div>

  <!-- Zone VidÃ©o -->
@if (isVideoCallActive){

  <div class="video-section">
    <div class="video-header">
      <h3>Appel vidÃ©o avec {{ remotePeerUsername }}</h3>
      <button (click)="endCall()" class="end-call-btn">
        Terminer l'appel
      </button>
    </div>

    <div class="video-container">
      <div class="remote-video-wrapper">
        <video #remoteVideo autoplay playsinline></video>
        <span class="video-label">{{ remotePeerUsername }}</span>
      </div>

      <div class="local-video-wrapper">
        <video #localVideo autoplay playsinline muted></video>
        <span class="video-label">Vous</span>
      </div>
    </div>

    <div class="video-controls">
      <button
        (click)="toggleAudio()"
        [class.disabled]="!isAudioEnabled">
        {{ isAudioEnabled ? 'ğŸ¤' : 'ğŸ”‡' }}
      </button>

      <button
        (click)="toggleVideo()"
        [class.disabled]="!isVideoEnabled">
        {{ isVideoEnabled ? 'ğŸ“¹' : 'ğŸ“µ' }}
      </button>

      <button (click)="endCall()" class="end-btn">
        âŒ Raccrocher
      </button>
    </div>
  </div>

}

@if (showVideoCallDialog) {
    <!-- Dialog Appel Entrant -->
    <div class="call-dialog" >
        <div class="dialog-content">
            <h3>Appel vidÃ©o entrant</h3>
            <p>{{ incomingCallFrom }} vous appelle</p>
            <div class="dialog-buttons">
                <button (click)="acceptCall()" class="accept-btn">
                    âœ… Accepter
                </button>
                <button (click)="rejectCall()" class="reject-btn">
                    âŒ Refuser
                </button>
            </div>
        </div>
    </div>
}

</div>
